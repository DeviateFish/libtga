/*! libtga 08-12-2014 */

!function(a){"use strict";var b=a.XMLHttpRequest||null,c=18,d=0,e=1,f=2,g=3,h=8,i=15,j=48,k=192,l=2,m=1,n=2,o=1,p=function(a){this.dataview=new DataView(a),this.header=p.readHeader(this.dataview),this.width=this.header.imageSpec.width,this.height=this.header.imageSpec.height,this.compressed=!!(this.header.imageType&h),this.imageId=p.readImageId(this.dataview,this.header),this.colorMap=p.readColorMap(this.dataview,this.header),this.imageData=p.readImage(this)};p.HEADER_SIZE=c,p.IMAGE_TYPE_NONE=d,p.IMAGE_TYPE_COLORMAPPED=e,p.IMAGE_TYPE_TRUECOLOR=f,p.IMAGE_TYPE_GREYSCALE=g,p.IMAGE_RUNLENGTH_ENCODED=h,p.readHeader=function(a){var b={idLength:a.getUint8(0,!0),mapType:a.getUint8(1,!0),imageType:a.getUint8(2,!0),colorMapSpec:p.readColorMapSpec(a,3),imageSpec:p.readImageSpec(a,8)};return b},p.readColorMapSpec=function(a,b){var c=a.getUint8(b+4,!0),d={firstEntry:a.getUint16(b,!0),length:a.getUint16(b+2,!0),entrySizeBits:c,entrySizeBytes:Math.floor((c+7)/8)};return d},p.readImageSpec=function(a,b){var c=a.getUint8(b+9),d={xOrigin:a.getUint16(b,!0),yOrigin:a.getUint16(b+2,!0),width:a.getUint16(b+4,!0),height:a.getUint16(b+6,!0),pixelDepth:a.getUint8(b+8),descriptor:c,attributeBits:c&i,origin:(c&j)>>4,interleave:(c&k)>>6};return d},p.readImageId=function(a,b){return new Uint8Array(a.buffer,c,b.idLength)},p.readColorMap=function(a,b){if(b.colorMapSpec.length<=0)return null;var d=new Uint8ClampedArray(4*b.colorMapSpec.length),e=null,f=c+b.idLength;switch(b.colorMapSpec.entrySizeBits){case 8:e=p.readPixel8;break;case 16:e=p.readPixel15;break;case 15:e=p.readPixel16;break;case 24:e=p.readPixel24;break;case 32:e=p.readPixel32;break;default:throw"Unsupported pixel depth"}for(var g=0;g<b.colorMapSpec.length;g++)e(a,f,g,d,g);return d},p.readPixel8=function(a,b,c,d,e){var f=a.getUint8(b+c);d[4*e+2]=f,d[4*e+1]=f,d[4*e+0]=f,d[4*e+3]=255},p.readPixel15=function(a,b,c,d,e){var f=a.getUint16(b+2*c,!0);d[4*e+2]=(31&f)<<3,d[4*e+1]=(f>>5&31)<<3,d[4*e+0]=(f>>10&31)<<3,d[4*e+3]=255},p.readPixel16=function(a,b,c,d,e){var f=a.getUint16(b+2*c,!0);d[4*e+2]=(31&f)<<3,d[4*e+1]=(f>>5&31)<<3,d[4*e+0]=(f>>10&31)<<3,d[4*e+3]=128==(128&f)?255:0},p.readPixel24=function(a,b,c,d,e){d[4*e+2]=a.getUint8(b+3*c+0),d[4*e+1]=a.getUint8(b+3*c+1),d[4*e+0]=a.getUint8(b+3*c+2),d[4*e+3]=255},p.readPixel32=function(a,b,c,d,e){d[4*e+2]=a.getUint8(b+4*c+0),d[4*e+1]=a.getUint8(b+4*c+1),d[4*e+0]=a.getUint8(b+4*c+2),d[4*e+3]=255},p.readMappedPixel8=function(a,b,c,d,e,f,g){var h=a.getUint8(d+e)+c;f[4*g+0]=b[4*h+0],f[4*g+1]=b[4*h+1],f[4*g+2]=b[4*h+2],f[4*g+3]=b[4*h+3]},p.readMappedPixel15=function(a,b,c,d,e,f,g){var h=a.getUint16(d+2*e,!0)+c;f[4*g+0]=b[4*h+0],f[4*g+1]=b[4*h+1],f[4*g+2]=b[4*h+2],f[4*g+3]=b[4*h+3]},p.readMappedPixel16=function(a,b,c,d,e,f,g){var h=a.getUint16(d+2*e,!0)+c;f[4*g+0]=b[4*h+0],f[4*g+1]=b[4*h+1],f[4*g+2]=b[4*h+2],f[4*g+3]=b[4*h+3]},p.readMappedPixel24=function(a,b,c,d,e,f,g){var h=a.getUint16(d+2*e,!0)+c;f[4*g+0]=b[4*h+0],f[4*g+1]=b[4*h+1],f[4*g+2]=b[4*h+2],f[4*g+3]=b[4*h+3]},p.readMappedPixel32=function(a,b,c,d,e,f,g){var h=a.getUint16(d+2*e,!0)+c;f[4*g+0]=b[4*h+0],f[4*g+1]=b[4*h+1],f[4*g+2]=b[4*h+2],f[4*g+3]=b[4*h+3]},p.readRLEImage=function(a){throw console.log(a.dataview,a.header),"NYI"},p.readColormappedImage=function(a){var b=a.dataview,d=a.header,e=a.colorMap,f=d.imageSpec.width,g=d.imageSpec.height,h=new Uint8ClampedArray(f*g*4),i=d.imageSpec.pixelDepth,j=c+d.idLength+d.colorMapSpec.length*d.colorMapSpec.entrySizeBytes,k=d.colorMapSpec.firstEntry,q=null,r=(d.imageSpec.origin&l)===n?1:-1,s=(d.imageSpec.origin&m)===o?-1:1;if(!e)throw"Image is described as color-mapped, but has no map";switch(i){case 8:q=p.readMappedPixel8;break;case 16:q=p.readMappedPixel15;break;case 15:q=p.readMappedPixel16;break;case 24:q=p.readMappedPixel24;break;case 32:q=p.readMappedPixel32;break;default:throw"Unsupported pixel depth"}var t,u,v,w;r>0?(t=0,u=g-1):(t=g-1,u=0),s>0?(v=0,w=f-1):(v=f-1,w=0);for(var x,y=0,z=t;z!=u;z+=r){x=0;for(var A=v;A!=w;A+=s)q(b,e,k,j,z*f+A,h,y*f+x++);y++}return h},p.readTruecolorImage=function(a){var b=a.header,d=a.dataview,e=b.imageSpec.width,f=b.imageSpec.height,g=new Uint8ClampedArray(e*f*4),h=b.imageSpec.pixelDepth,i=c+b.idLength+b.colorMapSpec.length*b.colorMapSpec.entrySizeBytes,j=null,k=(b.imageSpec.origin&l)===n?1:-1,q=(b.imageSpec.origin&m)===o?-1:1;switch(h){case 8:j=p.readPixel8;break;case 16:j=p.readPixel15;break;case 15:j=p.readPixel16;break;case 24:j=p.readPixel24;break;case 32:j=p.readPixel32;break;default:throw"Unsupported pixel depth"}var r,s,t,u;k>0?(r=0,s=f-1):(r=f-1,s=0),q>0?(t=0,u=e-1):(t=e-1,u=0);for(var v,w=0,x=r;x!=s;x+=k){v=0;for(var y=t;y!=u;y+=q)j(d,i,x*e+y,g,w*e+v++);w++}return g},p.readImage=function(a){if(a.header.compressed)return p.readRLEImage(a);if(0===a.header.mapType)return p.readTruecolorImage(a);if(1===a.header.mapType)return p.readColormappedImage(a);throw"Unsupported map type"};var q={readFile:function(a){return new p(a)},loadFile:function(a,c){var d=new b;d.open("GET",a),d.responseType="arraybuffer",d.onload=function(){c(null,new p(this.response))},d.onerror=function(a){c(a,null)},d.send()},TGA:p};q.VERSION="0.1.0",a.libtga=q}(this);
//# sourceMappingURL=libtga.min.js.map